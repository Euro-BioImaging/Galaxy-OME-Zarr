<tool id="mc2s3" name="mc2s3" version="0.0.0">
    <requirements>
        <requirement type="package" version = "1.59.2" >rclone</requirement>
    </requirements>
    <command><![CDATA[

if [ ! -d '$output.extra_files_path'/$dest_path ];then   
    mkdir -p '$output.extra_files_path'/$dest_path;
fi;

mkdir -p directory;
touch directory/rclone.conf;
rclone config create 'temp' 's3' --config=directory/rclone.conf \provider $config.provider \access_key_id $config.accesskey \secret_access_key $config.secretkey \endpoint $config.endpoint \acl private &> /dev/null;

#if str($input.ext)=='html':
    rclone --config directory/rclone.conf sync $input.extra_files_path 'temp':'$dest_path' ;
#else:
    ln $input './${input.element_identifier}';
    rclone --config directory/rclone.conf copy './${input.element_identifier}' 'temp':'$dest_path' ;
#end if
echo "transfer successful" > $output

    ]]></command>
    <inputs>
        <param name="input" type="data" format="tiff, tif, jpg, jpeg, png, html, lsm, lif" label=" Input data " />
        <param name="dest_path" type="text" value="copydir" label=" Output path at the at the s3 " />
        <section name="config" title=" Credentials for the private s3 remote " >
            <param name="provider" type="text" value="Minio" label=" Name of the provider " />
            <param name="accesskey" type="text" value="" label=" Access key id " />
            <param name="secretkey" type="text" value="" label=" Secret key id " />
            <param name="endpoint" type="text" value="" label=" Endpoint " />
        </section>
    </inputs>
    <outputs>
        <data name="output" format="html" label="Report" />
    </outputs>
</tool>

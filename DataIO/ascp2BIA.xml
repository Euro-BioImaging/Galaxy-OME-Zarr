<tool id="ascp2BIA" name="ascp2BIA" version="0.0.0">
    <requirements>
        <requirement type="package" version = "3.9.6" >aspera-cli</requirement>
    </requirements>
    <command><![CDATA[

if [ ! -d '$output.extra_files_path' ];then
    mkdir '$output.extra_files_path';
fi;

if [ ! -d '$output.extra_files_path/sshdir' ];then   
    mkdir -p '$output.extra_files_path/sshdir';
fi;

python $__tool_directory__/utils/write_ssh/main.py '$output.extra_files_path/sshdir/asperaweb_id_dsa.openssh';

#if str($input.ext) == 'html':
    python $__tool_directory__/ascp2BIA/main.py '$input.extra_files_path' $remote_path --port $credentials.port --sshkey '$output.extra_files_path'/sshdir/asperaweb_id_dsa.openssh --remote_location $credentials.remote_site;
#elif str($input.ext) == 'tiff':
    python $__tool_directory__/utils/copyfile/main.py '$input' $output.extra_files_path --newname ${input.element_identifier};
    #if str($remote_path) == '':
        python $__tool_directory__/ascp2BIA/main.py '$output.extra_files_path' . --port ${credentials.port} --sshkey '$output.extra_files_path'/sshdir/asperaweb_id_dsa.openssh --remote_location $credentials.remote_site;
    #else:
        python $__tool_directory__/ascp2BIA/main.py '$output.extra_files_path' $remote_path --port ${credentials.port} --sshkey '$output.extra_files_path'/sshdir/asperaweb_id_dsa.openssh --remote_location $credentials.remote_site;
    #end if
#end if

python $__tool_directory__/utils/complete_transfer/main.py --destination '$output';

##rm -r '$output.extra_files_path'/${input.element_identifier};
##rm -r '$output.extra_files_path'/sshdir;

###python $__tool_directory__/utils/warn.py;
    ]]></command>
    <inputs>
        <param name="input" type="data" format="html, tiff" label=" Input data " />
        <param name="remote_path" type="text" value="" label=" Output path at the BioStudies user space " />
        <section name="credentials" title=" Credentials for the BioStudies remote ">
            <param name="port" type="hidden" value="bsaspera_w@hx-fasp-1.ebi.ac.uk" />
            <param name="remote_site" type="text" value="" label=" Secret directory " />
        </section>
    </inputs>
    <outputs>
        <data name="output" format="html" label="Report" />
    </outputs>
</tool>



